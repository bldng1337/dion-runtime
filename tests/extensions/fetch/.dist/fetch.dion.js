//{"id":"fetch","name":"fetch","url":"www.example.com","icon":"www.example.com/icon.png","lang":[],"nsfw":false,"media_type":["Book"],"extension_type":[],"version":"1.0.0","license":"ISC","api_version":"*","repo":"string"}
import{fetch as a}from"network";import{getSetting as y}from"setting";class u{async validate(e){return e}async onEvent(e){switch(e.type){case"Action":return;case"FeedUpdate":return{type:e.type,customui:[],hasnext:null,length:null};case"SwapContent":return{type:e.type,customui:{type:"Text",text:"asd"}}}}async mapSource(e,t,n){return{source:e,settings:n}}async mapEntry(e,t){return{entry:e,settings:t}}async onEntryActivity(e,t,n){}async browse(e){let t=await o();return{content:(await a(`${t}/getEntries`)).json}}async search(e,t){let n=await o();return{content:(await a(`${n}/getEntries`)).json}}async handleUrl(e){return!0}async detail(e,t){let n=await o();return{entry:(await a(`${n}/getEntry`)).json,settings:t}}async source(e,t){let n=await o();return{source:(await a(`${n}/getSource`)).json,settings:t}}}async function o(){let e=await y("testdataserver","Extension"),t=e.value.data;if(e.value.type!=="String")throw Error("Failed to get Server");if(t.endsWith("/"))return t.substring(0,t.length-1);return t}function r(e,t="Extension error"){if(!e)throw Error(`Assert failed: ${t}`)}import{fetch as i,getCookies as d}from"network";async function c(e){let t=await i(`${e}/get`);r(t.status===200,"GET request failed");let n=JSON.parse(t.body);r(n.url===`${e}/get`,"GET request url is wrong")}async function l(e){let t=await i(`${e}/post`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:"value"})});r(t.status===200,"POST request failed");let n=JSON.parse(t.body);r(n.json.test==="value","POST request body is wrong")}async function g(e){let t=await i(`${e}/headers`,{headers:{"X-Test-Header":"test-value"}});r(t.status===200,"Headers request failed");let n=t.json;r(n.headers["x-test-header"]==="test-value",`Headers not sent correctly 


${t.body}`)}async function E(e){await i(`${e}/cookies/set?name=value`);let t=d();r(t.some((s)=>s.name==="name"&&s.value==="value"),`Cookies not set correctly expected name=value got ${JSON.stringify(t)}`);let n=await i(`${e}/testCookie`);r(n.status===200,"Cookie request failed"),r(n.body==="{}","Cookie request returned wrong body")}async function f(e){let t=await i(`${e}/status/404`);r(t.status===404,"Error handling for 404 failed"),r(t.ok===!1,"Error handling for 404 failed")}class A extends u{async load(){let e=await o();await c(e),await l(e),await g(e),await E(e),await f(e)}}export{A as default};
